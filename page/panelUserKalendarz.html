<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>SensoPark - autonomiczne parkingi</title>
	<link rel="stylesheet" type="text/css" href="css/global.css">
	<link rel="stylesheet" type="text/css" href="css/admin.css">
</head>
<body>
	<div id="container">
	<nav class="topbar">
		<a href="#" class="logo">
			<img alt="LOGO" src="img/logo.png">
		</a>
		<!-- <img alt="LOGO" src="img/logo.png" class="logo"> -->
		<ul class="navdir">
			<li>
				<a href="#">Strona główna</a>
			</li>
		</ul>
		<ul class="navdir navright">
			<li style="position: relative">
				<a href="#" id="drop-swicher"><span>Administrator, Marcin</span></a>
				<ul id="drop-menu" style="display: none;">
					<li class="drop-li">
						<a href="#" class="lin-btn">Moje konto</a>
						<a href="#" class="lin-btn" onclick="document.getElementById('logout-form').submit();">Wyloguj</a>
						<form id="logout-form" action="/linkdowylogowania" method="POST">
							<input type="hidden" name="logout_token" value="taknytokenGenerowany">
						</form>
					</li>
				</ul>
			</li>
		</ul>
	</nav>
	<div class="content">
		<div id="sidebar">
			<ul class="side-main">
				<li class="side-head">
					Parkingi
				</li>
				<li class="side-item">
					<a href="#" class="side-btn">&gt; Lista parkingów</a>
				</li>
				<li class="side-item">
					<a href="#" class="side-btn">&gt; Lista zarządców</a>
				</li>
				<li class="side-head">
					Użytkownicy
				</li>
				<li class="side-item">
					<a href="#" class="side-btn">&gt; Lista użytkowników</a>
				</li>

			</ul>
		</div>
		<div id="rest">
			<div>
				<h1 style="margin-left: 20px;">Zajętość parkingu - rezerwacje</h1>
				<div>
					<div class="one-day">
						<h2>Poniedziałek</h2>
						<div class="custom-select" style="width:200px;">
  <select>
    <option value="0">Select car:</option>
    <option value="1">Audi</option>
    <option value="2">BMW</option>
    <option value="3">Citroen</option>
    <option value="4">Ford</option>
    <option value="5">Honda</option>
    <option value="6">Jaguar</option>
    <option value="7">Land Rover</option>
    <option value="8">Mercedes</option>
    <option value="9">Mini</option>
    <option value="10">Nissan</option>
    <option value="11">Toyota</option>
    <option value="12">Volvo</option>
  </select>
</div>
						<input type="hidden" id="parkingidcalendar" value="1">
						<div id="parking-calendar-zaj">
							<!--<div class="cal-row">
								<div></div>
								<div></div>
							</div>
							<div class="cal-row">
								<div></div>
								<div></div>
							</div>-->
						</div>
							<div style="clear: both;"></div>
						<div id="parking-calendar-ops">
							<!--<div class="cal-hour">
								<div>12:00</div>
							</div>
							<div class="cal-hour">
								<div>13:30</div>
							</div>-->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="bottombar">
		<div class="bottom-col">
			<div style="position: relative;">
				<img alt="LOGO" src="img/logo.png" style="display: block; height: 150px; position: absolute; right: 0; bottom: 0; padding: 10px; transform: translate(50%, 0);">
			</div>
		</div>
		<div class="bottom-col">
			<span class="bottom-title">Szybkie linki</span>
			<a href="#" class="def-link">Strona główna</a>
			<a href="#" class="def-link">Moje konto</a>
			<a href="#" class="def-link">Regulamin</a>
			<a href="#" class="def-link">Regulamin</a>
			<a href="#" class="def-link">Regulamin</a>
			<a href="#" class="def-link">Regulamin</a>
		</div>
		<div class="bottom-col">
			<span class="bottom-title">Polityka prywatności</span>
			<a href="#" class="def-link">Polityka google</a>
			<a href="#" class="def-link">Coś jeszcze</a>
			<a href="#" class="def-link">RODO</a>
			<a href="#" class="def-link">Co to pliki cookie?</a>
			<a href="#" class="def-link">Wikipedia</a>
			<a href="#" class="def-link">Marcin Najman</a>
		</div>
		<div class="bottom-col">
			<span class="bottom-title">Regulamin serwisu</span>
			<a href="#" class="def-link">Regulamin w .pdf</a>
			<a href="#" class="def-link">Regulamin (odnośnik)</a>
			<a href="#" class="def-link">Regulamin (do druku)</a>
			<span class="bottom-title">Inne pliki</span>
			<a href="#" class="def-link">Załącznik nr 1</a>
			<a href="#" class="def-link">Załącznik nr 2</a>
		</div>
		<div>
			<span style="color: gray; letter-spacing: 1.5px;">&copy; Copyright 2020-2021 SensoPark - wszelkie prawa zastrzeżone.</span>
			<br>
			<span style="color: gray; letter-spacing: 1.5px;">Wykonane przez <a href="naszasuperfirma" class="def-link">Kalak &amp; Kryjom &amp; Migaj</a></span>
		</div>
	</div>
	</div>
	<script type="text/javascript" src="js/global.js"></script>
	<script type="text/javascript" src="js/admin.js"></script>
	<script type="text/javascript" src="js/debug.js"></script>
	<script type="text/javascript">
		function sel(r){
		    console.log("Sel: "+("rezer"+r.getAttribute("rownum")));
		    document.getElementById("rezer"+r.getAttribute("rownum")).selected = true;
			//alert("godzRow"+);
		}
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var res = JSON.parse(this.responseText);
				var ilegodzin = 24*2;
				//var ileparkingow = 10;
				var cal = document.getElementById("parking-calendar-zaj");
				if(cal.childElementCount > 1){
				    return;
				}
				for(var row = 0; row < ilegodzin; row++){
					var r = document.createElement("div");
					r.classList.add("cal-row");
					r.classList.add("tooltip");
					//var ileprocent = Math.random()*row*100.0/ilegodzin;
					console.log("Ile:"+res.reservation[row]);
					var ileprocent = Number.parseInt(res.reservation[row])*100.0/res.maxparking;
					//r.style.height = (100-ileprocent)+"px";
					var goh1 = Math.floor(row/2);
					if(row % 2 == 1){
					    goh1 += ":30";
					}else{
					    goh1 += ":00";
					}
					var goh2 = Math.floor((row)/2);

					if(row % 2 == 1){
					    goh2 = (goh2+1)+":00";
					}else{
					    goh2 = goh2+":30";
					}
					var goh ="<br>"+ goh1 +" - "+goh2;
					var spn = 'Rezerwacja' +goh;
					spn = "Zajęte: "+ileprocent+"%<br>"+spn;
					if(res.reservation[row] >= res.maxparking){
					 	spn = 'Brak miejsc';
					}
					spn = '<span class="tooltiptext">'+spn+'</span>';
					r.innerHTML = '<div style="height: '+(100-ileprocent)+'%;"></div><div></div>'+spn;//<div class="cal-hour"><div>12:00</div></div>';
					r.setAttribute("rownum",row);
					r.onclick = function(){
					    sel(this);
					};
					cal.appendChild(r);
					if(row % 2 == 1 && row != ilegodzin-1){
						var spac = document.createElement("div");
						spac.classList.add("cal-space");
						cal.appendChild(spac);
					}

				}
				var obj = document.getElementById("parking-calendar-ops");
				for(var row = 0; row < ilegodzin; row++){
					if(row % 2 == 0){
						var spac = document.createElement("div");
						spac.classList.add("cal-hour");
						spac.innerHTML = '<div>'+(row/2)+':00</div>';
						obj.appendChild(spac);
					}
				}
			}else{
			    var res = JSON.parse('{"id":9,"maxparking":"4","reservation":[3,2,2,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2]}');
				console.log(res);
				var ilegodzin = 24*2;
				//var ileparkingow = 10;
				var cal = document.getElementById("parking-calendar-zaj");
				if(cal.childElementCount > 1){
				    return;
				}
				for(var row = 0; row < ilegodzin; row++){
					var r = document.createElement("div");
					r.classList.add("cal-row");
					r.classList.add("tooltip");
					//var ileprocent = Math.random()*row*100.0/ilegodzin;
					console.log("Ile:"+res.reservation[row]);
					var ileprocent = Number.parseInt(res.reservation[row])*100.0/res.maxparking;
					//r.style.height = (100-ileprocent)+"px";
					var goh1 = Math.floor(row/2);
					if(row % 2 == 1){
					    goh1 += ":30";
					}else{
					    goh1 += ":00";
					}
					var goh2 = Math.floor((row)/2);

					if(row % 2 == 1){
					    goh2 = (goh2+1)+":00";
					}else{
					    goh2 = goh2+":30";
					}
					var goh ="<br>"+ goh1 +" - "+goh2;
					var spn = 'Rezerwacja' +goh;
					spn = "Zajęte: "+ileprocent+"%<br>"+spn;
					if(res.reservation[row] >= res.maxparking){
					 	spn = 'Brak miejsc';
					}
					spn = '<span class="tooltiptext">'+spn+'</span>';
					r.innerHTML = '<div style="height: '+(100-ileprocent)+'%;"></div><div></div>'+spn;//<div class="cal-hour"><div>12:00</div></div>';
					r.setAttribute("rownum",row);
					r.onclick = function(){
					    sel(this);
					};
					cal.appendChild(r);
					if(row % 2 == 1 && row != ilegodzin-1){
						var spac = document.createElement("div");
						spac.classList.add("cal-space");
						cal.appendChild(spac);
					}
				}
				var obj = document.getElementById("parking-calendar-ops");
				for(var row = 0; row < ilegodzin; row++){
					if(row % 2 == 0){
						var spac = document.createElement("div");
						spac.classList.add("cal-hour");
						spac.innerHTML = '<div>'+(row/2)+':00</div>';
						obj.appendChild(spac);
					}
				}
			}
		};
		var data = new Date();
		var dat = data.getDay() +"-"+ data.getMonth() +"-"+ data.getFullYear();
		dat = "21-02-13";
		console.log(res);
		xhttp.open("GET", "/parking_reservation/"+document.getElementById("parkingidcalendar").value+"/"+dat+"/", true);
		//xhttp.open("GET", "a/parking_reservation.json", true);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send();
		/*var res = JSON.parse('{"id":9,"maxparking":"4","reservation":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2]}');
		console.log(res);
		var ilegodzin = 24*2;
		//var ileparkingow = 10;
		var cal = document.getElementById("parking-calendar-zaj");
		for(var row = 0; row < ilegodzin; row++){
			var r = document.createElement("div");
			r.classList.add("cal-row");
			//var ileprocent = Math.random()*row*100.0/ilegodzin;
			console.log("Ile:"+res.reservation[row]);
			var ileprocent = Number.parseInt(res.reservation[row])*100.0/res.maxparking;
			//r.style.height = (100-ileprocent)+"px";
			r.innerHTML = '<div style="height: '+(100-ileprocent)+'%;"></div><div></div>';//<div class="cal-hour"><div>12:00</div></div>';
			cal.appendChild(r);
			if(row % 2 == 1 && row != ilegodzin-1){
				var spac = document.createElement("div");
				spac.classList.add("cal-space");
				cal.appendChild(spac);
			}
		}
		var obj = document.getElementById("parking-calendar-ops");
		for(var row = 0; row < ilegodzin; row++){
			if(row % 2 == 0){
				var spac = document.createElement("div");
				spac.classList.add("cal-hour");
				spac.innerHTML = '<div>'+(row/2)+':00</div>';
				obj.appendChild(spac);
			}
		}*/
		var x, i, j, l, ll, selElmnt, a, b, c;
		x = document.getElementsByClassName("custom-select");
		l = x.length;
		for (i = 0; i < l; i++) {
		  selElmnt = x[i].getElementsByTagName("select")[0];
		  ll = selElmnt.length;
		  a = document.createElement("DIV");
		  a.setAttribute("class", "select-selected");
		  a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
		  x[i].appendChild(a);
		  b = document.createElement("DIV");
		  b.setAttribute("class", "select-items select-hide");
		  for (j = 1; j < ll; j++) {
		    c = document.createElement("DIV");
		    c.innerHTML = selElmnt.options[j].innerHTML;
		    c.addEventListener("click", function(e) {
		        var y, i, k, s, h, sl, yl;
		        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
		        sl = s.length;
		        h = this.parentNode.previousSibling;
		        for (i = 0; i < sl; i++) {
		          if (s.options[i].innerHTML == this.innerHTML) {
		            s.selectedIndex = i;
		            h.innerHTML = this.innerHTML;
		            y = this.parentNode.getElementsByClassName("same-as-selected");
		            yl = y.length;
		            for (k = 0; k < yl; k++) {
		              y[k].removeAttribute("class");
		            }
		            this.setAttribute("class", "same-as-selected");
		            break;
		          }
		        }
		        h.click();
		    });
		    b.appendChild(c);
		  }
		  x[i].appendChild(b);
		  a.addEventListener("click", function(e) {
		      e.stopPropagation();
		      closeAllSelect(this);
		      this.nextSibling.classList.toggle("select-hide");
		      this.classList.toggle("select-arrow-active");
		    });
		}
		function closeAllSelect(elmnt) {
		  var x, y, i, xl, yl, arrNo = [];
		  x = document.getElementsByClassName("select-items");
		  y = document.getElementsByClassName("select-selected");
		  xl = x.length;
		  yl = y.length;
		  for (i = 0; i < yl; i++) {
		    if (elmnt == y[i]) {
		      arrNo.push(i)
		    } else {
		      y[i].classList.remove("select-arrow-active");
		    }
		  }
		  for (i = 0; i < xl; i++) {
		    if (arrNo.indexOf(i)) {
		      x[i].classList.add("select-hide");
		    }
		  }
		}
		document.addEventListener("click", closeAllSelect);
	</script>
</body>
</html>